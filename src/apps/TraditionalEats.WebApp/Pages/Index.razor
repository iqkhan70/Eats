@page "/"
@using Radzen
@using Radzen.Blazor
@using Microsoft.AspNetCore.Components
@inject NavigationManager NavigationManager

<PageTitle>TraditionalEats - Traditional Food Delivery</PageTitle>

<RadzenStack Gap="1.5rem" Style="padding: 1rem; width: 100%; max-width: 100vw; box-sizing: border-box;" Class="page-container">
    <RadzenText TextStyle="TextStyle.H1">Welcome to TraditionalEats</RadzenText>
    <RadzenText TextStyle="TextStyle.Body1">
        Discover authentic traditional food from local restaurants, delivered to your door.
    </RadzenText>
    
    <RadzenCard Style="margin-top: 1rem;">
        <RadzenStack Gap="1rem">
            <RadzenText TextStyle="TextStyle.H3">Find Restaurants Near You</RadzenText>
            <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" AlignItems="AlignItems.End" Class="search-container">
                <RadzenFormField Text="Enter your location" class="w-100" Style="flex: 1;">
                    <RadzenTextBox @ref="searchTextBox" @bind-Value="@searchLocation" Placeholder="Enter your address or location" />
                </RadzenFormField>
                <RadzenButton Text="Search" Icon="search" Click="@SearchRestaurants" Variant="Variant.Flat" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenCard Style="margin-top: 1rem; width: 100%; max-width: 100%;" Class="categories-container">
        <RadzenStack Gap="1rem">
            <RadzenText TextStyle="TextStyle.H3">Popular Categories</RadzenText>
            <RadzenStack Orientation="Orientation.Horizontal" Gap="0.75rem" Style="flex-wrap: wrap; width: 100%;" Class="categories-stack">
                @foreach (var category in displayedCategories)
                {
                    <RadzenCard Style="cursor: pointer;" Class="category-card" Click="@(() => NavigateToCategory(category))">
                        <RadzenStack Gap="0.5rem" Style="align-items: center; text-align: center;">
                            <RadzenIcon Icon="@category.Icon" Style="font-size: 48px; color: var(--rz-primary);" />
                            <RadzenText TextStyle="TextStyle.Body1">@category.Name</RadzenText>
                        </RadzenStack>
                    </RadzenCard>
                }
            </RadzenStack>
            @if (categories.Count > initialCategoryCount)
            {
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Center" Style="margin-top: 0.5rem;">
                    <RadzenButton 
                        Text="@(showAllCategories ? "Show Less" : $"Show All ({categories.Count})")" 
                        Icon="@(showAllCategories ? "expand_less" : "expand_more")"
                        Click="@ToggleCategories" 
                        Variant="Variant.Flat" 
                        Size="ButtonSize.Small" />
                </RadzenStack>
            }
        </RadzenStack>
    </RadzenCard>
</RadzenStack>

@code {
    private RadzenTextBox? searchTextBox;
    private string searchLocation = string.Empty;
    private bool showAllCategories = false;
    private const int initialCategoryCount = 6;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && searchTextBox != null)
        {
            await searchTextBox.FocusAsync();
        }
    }

    private List<CategoryItem> categories = new()
    {
        new CategoryItem { Name = "Traditional", Icon = "restaurant" },
        new CategoryItem { Name = "Fast Food", Icon = "fastfood" },
        new CategoryItem { Name = "Desserts", Icon = "cake" },
        new CategoryItem { Name = "Beverages", Icon = "local_drink" },
        new CategoryItem { Name = "Vegetarian", Icon = "eco" },
        new CategoryItem { Name = "Vegan", Icon = "spa" },
        new CategoryItem { Name = "Seafood", Icon = "set_meal" },
        new CategoryItem { Name = "BBQ", Icon = "outdoor_grill" },
        new CategoryItem { Name = "Italian", Icon = "dinner_dining" },
        new CategoryItem { Name = "Asian", Icon = "ramen_dining" }
    };

    private List<CategoryItem> displayedCategories => showAllCategories 
        ? categories 
        : categories.Take(initialCategoryCount).ToList();

    private void SearchRestaurants()
    {
        if (!string.IsNullOrEmpty(searchLocation))
        {
            NavigationManager.NavigateTo($"/restaurants?location={Uri.EscapeDataString(searchLocation)}");
        }
        else
        {
            NavigationManager.NavigateTo("/restaurants");
        }
    }

    private void NavigateToCategory(CategoryItem category)
    {
        NavigationManager.NavigateTo($"/restaurants?category={Uri.EscapeDataString(category.Name)}");
    }

    private void ToggleCategories()
    {
        showAllCategories = !showAllCategories;
    }

    private class CategoryItem
    {
        public string Name { get; set; } = string.Empty;
        public string Icon { get; set; } = string.Empty;
    }
}
